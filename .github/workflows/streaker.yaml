---
name: Streaker!

"on":
  schedule:
    - cron: 42 */11 * * *

  workflow_dispatch:

jobs:
  streaker:
    runs-on: ubuntu-latest

    container:
      image: mcr.microsoft.com/playwright:v1.46.0

    steps:
      - name: Run Streaker!
        env:
          TG_USERNAME: ${{ env.TG_USERNAME }}
          TG_PASSWORD: ${{ secrets.TG_PASSWORD }}
        run: >
          npm install playwright &&
          node -e '
            (async () => {
              const { chromium } = require("playwright");

              const username = process.env.TG_USERNAME;
              const password = process.env.TG_PASSWORD;
              const options = { exact: true };

              const browser = await chromium.launch();
              const context = await browser.newContext();
              const page = await context.newPage();

              const goto = async (url) => {
                const response = await page.goto(url);
                if (!response.ok()) throw new Error(`Failed to load ${url}`);
              };

              await page.goto("https://www.thetagang.com/login");

              const usernameInput = page.getByPlaceholder("username", options);
              const passwordInput = page.getByPlaceholder("password", options);

              await usernameInput.click();
              await usernameInput.fill(username);
              await passwordInput.click();
              await passwordInput.fill(password);
              await page.keyboard.press("Enter");

              await goto("https://www.thetagang.com/discover");
              await goto("https://www.thetagang.com/tracker");
              await goto("https://www.thetagang.com/about");
              await goto("https://www.thetagang.com/");

              await page.close();
              await context.close();
              await browser.close();
            })();
          '
