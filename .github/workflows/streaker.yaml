---
name: Streaker!

"on":
  schedule:
    - cron: 42 */11 * * *

  workflow_dispatch:

jobs:
  streaker:
    runs-on: ubuntu-latest

    container:
      image: mcr.microsoft.com/playwright:v1.46.0

    steps:
      - name: Run Streaker!
        env:
          TG_USERNAME: ${{ env.TG_USERNAME }}
          TG_PASSWORD: ${{ secrets.TG_PASSWORD }}
        run: >
          npm install playwright &&
          node -e '
            (async () => {
              const { chromium } = require("playwright");

              const username = process.env.TG_USERNAME;
              const password = process.env.TG_PASSWORD;
              const options = { exact: true };

              const browser = await chromium.launch();
              const context = await browser.newContext();
              const page = await context.newPage();

              await page.goto("https://www.thetagang.com/login");

              const usernameInput = page.getByPlaceholder("username", options);
              const passwordInput = page.getByPlaceholder("password", options);

              await usernameInput.click();
              await usernameInput.fill(username);

              await passwordInput.click();
              await passwordInput.fill(password);

              await page.getByRole("button", { name: "Login" }).click();

              await page.locator("[id=\"C\"]").getByText("Discover").click();
              await page.locator("[id=\"C\"]").getByText("Tracker").click();
              await page.locator("[id=\"C\"]").getByText("About").click();
              await page.getByText("Home").click();

              await page.close();
              await context.close();
              await browser.close();
            })();
          '
